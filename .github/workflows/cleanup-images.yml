name: Cleanup Container Images

on:
  push:
  schedule:
    - cron: '0 2 * * 0'
  workflow_run:
    workflows: ["Release Please"]
    types: [completed]
  workflow_dispatch:
    inputs:
      dry_run:
        description: 'Dry run mode'
        type: boolean
        default: true
      test_retention_days:
        description: 'Test/PR image retention (days, default: 30)'
        type: number
        required: false
      others_retention_days:
        description: 'Other image retention (days, default: 7)'
        type: number
        required: false

jobs:
  cleanup:
    runs-on: ubuntu-latest
    permissions:
      packages: write
      contents: read
    steps:
      - uses: developmentseed/container-registry-cleanup@main
        env:
          REGISTRY_TYPE: ghcr
          REPOSITORY_NAME: titiler-openeo
          GITHUB_REPO_OWNER: sentinel-hub
          DRY_RUN: ${{ github.event_name == 'push' && 'true' || github.event.inputs.dry_run || 'false' }}
          DEBUG: true
          TEST_RETENTION_DAYS: ${{ github.event.inputs.test_retention_days || '30' }}
          OTHERS_RETENTION_DAYS: ${{ github.event.inputs.others_retention_days || '7' }}
